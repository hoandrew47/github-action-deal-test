name: Test Deploy

on:
  workflow_dispatch:
    inputs:
      branch-name:
        description: 'Branch to deploy'
        required: true
        type: string

jobs:
  echo_hello:
    name: Echo Hello
    runs-on: ubuntu-latest
    steps:
      - name: Echo Hello
        run: echo "Hello"

  set_env:
    name: Set Deployment Environment
    runs-on: ubuntu-latest
    needs: echo_hello
    outputs:
      environment: ${{ steps.set_env.outputs.environment }}
    steps:
      - name: Set Deployment Environment
        id: set_env
        run: echo "environment=production" >> $GITHUB_ENV
            echo "environment=production" >> $GITHUB_OUTPUT
         

  approval:
    name: Approval for Production Deployment
    runs-on: ubuntu-latest
    needs: set_env
    environment:
      name: ${{ needs.set_env.outputs.environment }}
      # Configure required reviewers for 'production' if applicable
    steps:
      - name: Await Approval
        run: echo "Awaiting manual approval to deploy."

  deploy_production:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: approval
    if: ${{ needs.set_env.outputs.environment == 'production' }}
    steps:
      - name: Deploy to Production
        run: |
          echo "Deploying to Production"
          # Add your production deployment commands here

  deploy_staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    needs: approval
    if: ${{ needs.set_env.outputs.environment == 'staging' }}
    steps:
      - name: Deploy to Staging
        run: |
          echo "Deploying to Staging"
          # Add your staging deployment commands here

  echo_finished:
    name: Echo Finished
    runs-on: ubuntu-latest
    needs: [deploy_production, deploy_staging]
    steps:
      - name: Echo Finished
        run: echo "Finished"
