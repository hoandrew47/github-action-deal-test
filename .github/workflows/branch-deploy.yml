name: Branch Deploy

on:
  workflow_dispatch:
    inputs:
      branch-name:
        description: 'Branch to deploy'
        required: true
        type: string
        default: 'branch-review'
      neon-username:
        description: 'Neon username'
        required: true
        type: string
      neon-password:
        description: 'Neon password'
        required: true
        type: string

jobs:
  setup-database:
    runs-on: ubuntu-latest
    steps:
      - name: Sets up a branch on Neon
        uses: neondatabase/create-branch-action@v5
        id: create-branch
        with:
          project_id: ${{ secrets.NEON_BRANCH_PROJECT_ID }}
          branch_name: ${{ github.event.inputs.branch-name }}
          database: main
          username: ${{ github.event.inputs.neon-username }}
          password: ${{ github.event.inputs.neon-password }}
          prisma: true
          api_key: ${{ secrets.NEON_API_KEY }}
      - run: echo "Database URL: ${{ steps.create-branch.outputs.db_url }}"
      - run: echo "Host: ${{ steps.create-branch.outputs.host }}"
      - run: echo "Branch ID: ${{ steps.create-branch.outputs.branch_id }}"
